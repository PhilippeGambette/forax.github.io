<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>JavaScript - 6 - let, class, fonction flèche, assignation destructurée</title>

		<meta name="description" content="javascript, let, class, notation flèche">
		<meta name="author" content="Remi Forax">

		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
		
		<!-- autojs result -->
		<style>
		  div.autojsresult {
		    text-align: left;
		    color: lime;
		  }
		  div.autojslog {
		    color: orange;
		  }
		  div.autojserror {
		    color: red;
		  }
		  .bad-container {
            position: relative;
            display:inline-block;
          }
		  .bad-image:after {
            content: url(images/js/bad.png);
            position: absolute;
            z-index: 9999;
            right: 5px;
            bottom: 0px;
          }
		</style>
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
                                <section>
					<h1>JavaScript</h1>
                                       <br/>
                                        <h2><strike>JavaScript 6</strike></h2>
                                        <h2>JavaScript 2015</h2>
					<p>
					  Remi Forax
					</p>
				</section>
				                <section>
				                        <h2>Fonction Flèche</h2>
				                </section>             
				                <section>
					                    <h2>Fonction Flèche</h2>
					                    <p>
                                         Syntaxe plus compacte lorsque l'on définie une fonction anonyme
                                        </p>
                                        <p>&nbsp;</p>
                                        <small><textarea autojs="js6-arrowfun" rows="6" cols="45">
var add1 = function(a, b) { return a + b; };
add1(2, 3)

var add2 = (a, b) => a + b;
add2(2, 3)
                                        </textarea></small>
                                        <small><div id="js6-arrowfun"></div></small>
                                        <p>&nbsp;</p>
				                </section>
				                <section>
					                    <h2>Syntaxe des Fonctions Flèches</h2>
					                    <p>
                                         Si il n'y à qu'un seul paramètre, les parenthèses autour des
                                         paramètres ne sont pas obligatoire.
                                        </p>
                                        <p>&nbsp;</p>
                                        <small><textarea autojs="js6-arrowfun2" rows="9" cols="45">
var hello = () => "hello";
hello()

var identity = x => x;
identity(3)

var add = (a, b) => a + b;
add(4, 5)
                                        </textarea></small>
                                        <small><div id="js6-arrowfun2"></div></small>
                                        <p>&nbsp;</p>
				                </section>
				                
				                <section>
				                        <h2>let, var &amp; const</h2>
				                </section>             
				                <section>
					             <h2>Problèmes de var</h2>
					                    <p>
                                         Les vars sont remontés en haut des fonctions ! 
                                        </p>
                                        <p>&nbsp;</p>
                                        <small><textarea autojslog="js6-var" rows="3" cols="50">
console.log(a);      // oups, marche quand même
var a = 3;
                                        </textarea></small>
                                        <p></p>
                                        <small>
                                         <div id="js6-var" class="autojslog"></div>
                                        </small>
                                        <p></p>
                                        <small><textarea autojslog="js6-var2" rows="6" cols="50">
var array = [];
for(var i = 0; i < 3; i++) {
  array.push(() => i);
}
console.log(array.map(f => f()));
                                        </textarea></small>
                                        <p></p>
                                        <small>
                                         <div id="js6-var2" class="autojslog"></div>
                                        </small>
				                </section>
				                
				                <section>
					             <h2>let à la place de var</h2>
					                    <p>
                                         <b>let</b> définie une variable de l'endroit où on la déclare
                                         jusqu'à la parenthèse fermante du bloc qui la contient 
                                        </p>
                                        <p>&nbsp;</p>
                                        <small><textarea autojslog="js6-let" rows="3" cols="45">
console.log(a);
let a = 3;
                                        </textarea></small>
                                        <p></p>
                                        <small>
                                         <div id="js6-let" class="autojslog"></div>
                                        </small>
                                        <p></p>
                                        <small><textarea autojslog="js6-let2" rows="6" cols="45">
let array = [];
for(let i = 0; i < 3; i++) {
  array.push(() => i);
}
console.log(array.map(f => f()));
                                        </textarea></small>
                                        <p></p>
                                        <small>
                                         <div id="js6-let2" class="autojslog"></div>
                                        </small>
				                </section>
				
				                <section>
					             <h2>const pour les constantes</h2>
					                    <p>
                                         <b>const</b> définie une variable dont la valeur
                                        <br/>
                                         ne peut pas changer 
                                        </p>
                                        <p>&nbsp;</p>
                                        <small><textarea autojslog="js6-const" rows="3" cols="45">
const RETRY = 3;
console.log(RETRY);
                                        </textarea></small>
                                        <p></p>
                                        <small>
                                         <div id="js6-const" class="autojslog"></div>
                                        </small>
                                        <p></p>
                                        <small><textarea autojslog="js6-const2" rows="3" cols="45">
const A = 3;
const A = 4;
                                        </textarea></small>
                                        <p></p>
                                        <small>
                                         <div id="js6-const2" class="autojslog"></div>
                                        </small>
				                </section>
				
				                <section>
				                        <h2>Assignation destructurée</h2>
				                </section>
                                <section>
					 <h2>Assignation destructurée</h2>
					 <p>
                                          Il est possible de mettre des '[' ']' en partie gauche d'une assignation pour récupérer les valeurs d'un tableau
                                         </p>
                                        <p>&nbsp;</p>
                                        <small><textarea autojs="js6-destructured" rows="6" cols="35">
let array = ['a', 'b', 'c' ];
let [v, w, x] = array;
v
w
x
                                        </textarea></small>
                                        <small><div id="js6-destructured"></div></small>
                                        <p>&nbsp;</p>
                                        <p>
                                         Attention a ne pas oublier le <b>var</b> ! 
                                        </p>
				</section>
				
                                <section>
					 <h2>Assignation destructurée (2)</h2>
					 <p>
                                          Il est possible d'omettre des variables si on ne veut pas récupérer certaines valeurs
                                         </p>
                                        <p>&nbsp;</p>
                                        <small><textarea autojs="js6-destructured2" rows="6" cols="35">
let array = ['a', 'b', 'c' ];
let [v, , w] = array;
v
w
                                        </textarea></small>
                                        <small><div id="js6-destructured2"></div></small>
                                        <p>&nbsp;</p>
				</section>
                                <section>
					 <h2>Assignation destructurée (3)</h2>
					 <p>
                                          On peut aussi séparer la déclaration (let ...)
                                         <br/>
                                          de l'assignation destructurée ([...] = ...)
                                         </p>
                                        <p>&nbsp;</p>
                                        <small><textarea autojs="js6-destructured3" rows="6" cols="35">
let array = ['a', 'b', 'c' ];
let v, w;
[v, , w] = array;
v
w
                                        </textarea></small>
                                        <small><div id="js6-destructured3"></div></small>
                                        <p>&nbsp;</p>
				</section>
                                <section>
					 <h2>Assignation destructurée (4)</h2>
					 <p>
                                          donc on peut écrire un <b>swap</b> facilement
                                         </p>
                                        <p>&nbsp;</p>
                                        <small><textarea autojs="js6-destructured4" rows="6" cols="35">
let a = 39;
let b = 45;
[b, a] = [a, b]
a
b
                                        </textarea></small>
                                        <small><div id="js6-destructured4"></div></small>
                                        <p>&nbsp;</p>
				</section>
				<section>
					 <h2>Avec une fonction</h2>
					 <p>
                                          Cela permet à une fonction de renvoyer plusieurs valeurs
                                         </p>
                                        <p>&nbsp;</p>
                                        <small><textarea autojslog="js6-destructured-fun" rows="10" cols="40">
function minmax(a, b) {
  if (a &lt; b) {
    return [a, b];
  }
  return [b, a];
}

let [min, max] = minmax(10, 3);
console.log(min + " " + max);
                                        </textarea></small>
                                        <p></p>
                                        <small>
                                         <div id="js6-destructured-fun" class="autojslog"></div>
                                        </small>
                                        <p>&nbsp;</p>
				</section>
                                <section>
					 <h2>Avec un objet</h2>
					 <p>
                                          L'assignation destructurée marche aussi avec les objets
                                         <br/>
                                          en utilisant '{' et '}' à la place de '[' et ']'.
                                         </p>
                                        <p>&nbsp;</p>
                                        <small><textarea autojslog="js6-destructured-object" rows="5" cols="35">
let person = { name: "john", age: 12 };
let {name, age} = person;
console.log(name);
console.log(age); 
                                        </textarea></small>
                                        <p></p>
                                        <small>
                                         <div id="js6-destructured-object" class="autojslog"></div>
                                        </small>
                                        <p>&nbsp;</p>
				</section>
				                 <section>
				                        <h2>Les Classes</h2>
				                </section>
                                
				<section>
					<h2>Définition d'une classe</h2>
					<p>
                                         Une classe définie un modéle de création d'objets.
                                        </p><p>
                                         Une classe contient des <b>méthodes</b> (fonctions qui agissent sur <b>this</b>) et
                                         un <b>constructeur</b> (méthode d'initialisation)
                                        </p>
                                        
                                        <small><textarea autojslog="js6-class" rows="13" cols="35">
class Car {
  constructor(driver) {
    this.driver = driver;
    this.wheels = 4;
  }
  driverName() {
    return this.driver;
  }
}

let car = new Car("bob");
console.log(car.driverName());
                                        </textarea></small>
                                        <p></p>
                                        <small>
                                         <div id="js6-class" class="autojslog"></div>
                                        </small>
				</section>
				                <section>
					<h2>Classe et délégué/prototype</h2>
					<p>
					    Une classe est vu comme une fonction dont le code appel le constructeur.
					    Les méthodes de la classe sont ajoutés au prototype de la fonction.
                                        </p>
                                        <div style="float: left;">
                                        <small><textarea autojslog="js6-class3a" rows="12" cols="35">
class Square {
  constructor(side) {
    this.side = side;
  }
  surface() {
    return this.side * this.side;
  }
}

let square = new Square(3);
console.log(square.surface());
                                        </textarea></small>
                                        <p><small>JavaScript 6</small></p>
                                        <small>
                                         <div id="js6-class3a" class="autojslog"></div>
                                        </small>
                                        </div><div>
                                        <small><textarea autojslog="js6-class3b" rows="12" cols="35">
function Square(side) {
  this.side = side;
}

Square.prototype.surface = function() {
  return this.side * this.side;
};

let square = new Square(3);
console.log(square.surface());
                                        </textarea></small>
                                        <p><small>JavaScript &lt; 6</small></p>
                                        <small>
                                         <div id="js6-class3b" class="autojslog"></div>
                                        </small>
                                        </div>
				</section>
                                <section>
					<h2>La notation "class"</h2>
					<p>
                                         La notation est un peu plus verbeuse que la notation classique,
                                         donc quel est l'intérêt d'introduire cette nouvelle notation ?
                                        </p>
                                        <p class="fragment">
                                         Permet de <b>regrouper</b> dans un même endroit l'initialisation et la manipulation d'un type nommé
                                        </p>
                                        <p class="fragment">
                                         La notion de classe <b>existe déjà</b> dans plusieurs autres languages (C++, Java, Swift, Rust) et est donc mieux compris que la notion de délégation propre à JavaScript
                                        </p>
				</section>
				                <section>
				                        <h2>Héritage</h2>
				                </section>
                                <section>
					<h2>Héritage</h2>
					<p>
                                         Définir une classe en étendant des propriétés d'une classe existante
                                        </p>
                                        <p>&nbsp;</p>
                                        <small><textarea autojslog="js6-class-inheritance" rows="11" cols="45">
class A {
  hello() { return "hello"; }
}
class B extends A {
  msg(name) { return this.hello() + " " + name; }
}

let b = new B();
console.log(b.hello());
console.log(b.msg("bob"));
                                        </textarea></small>
                                        <p></p>
                                        <small>
                                         <div id="js6-class-inheritance" class="autojslog"></div>
                                        </small>
				</section>
                                <section>
					             <h2>super()</h2>
					             <p>
                                         super() permet d'appeler le constructeur de la super-classe
                                        </p>
                                        <p>&nbsp;</p>
                                        <small><textarea autojslog="js6-class-super" rows="11" cols="45">
class Box {
  constructor(x) { this.x = x; }
  str() { return this.x; }
}
class Point extends Box {
  constructor(x, y) { super(x); this.y = y; }
}

let array = [new Box(3), new Point(1, 2)];
array.map(v => v.str()).forEach(console.log);
                                        </textarea></small>
                                        <p></p>
                                        <small>
                                         <div id="js6-class-super" class="autojslog"></div>
                                        </small>
				                 </section>
				                 <section>
					                    <h2>super.m()</h2>
					                    <p>
					                     Une propriété cache la propriété existante dans la super classe,
					                     super.m() permet d'accéder à la méthode m de la super classe
                                        </p>
                                        
                                        <small><textarea autojslog="js6-class-super2" rows="11" cols="45">
class Box {
  constructor(x) { this.x = x; }
  str() { return this.x; }
}
class Point extends Box {
  constructor(x, y) { super(x); this.y = y; }
  str() { return super.str() + ", " + this.y; }
}
let array = [new Box(3), new Point(1, 2)];
array.map(v => v.str()).forEach(console.log);
                                        </textarea></small>
                                        <p></p>
                                        <small>
                                         <div id="js6-class-super2" class="autojslog"></div>
                                        </small>
				</section>
                                
                                <section>
					<h2>Problème de l'héritage</h2>
					<p>
                                         Si on insére une méthode dans une super-classe,
                                        <br/> 
                                         il <b>faut redéfinir</b> celle-ci dans toutes les sous-classes
                                        </p>
                                        <small><div class="bad-container"><textarea autojslog="js6-class-inherit" rows="13" cols="45">
class Square {
  constructor(side) { this.side = side; }
  surface() { return this.side * this.side; }
}
class Rectangle extends Square {
  constructor(width, height) {
    super(width); this.height = height; 
  }
  //surface() { return this.width * this.height; }
}
var array = [new Square(3), new Rectangle(2, 3)];
console.log(array.map(e => e.surface()));
                                        </textarea><div class="bad-image"></div></div></small>
                                        <p></p>
                                        <small>
                                         <div id="js6-class-inherit" class="autojslog"></div>
                                        </small>
				</section>
				                     <section>
					                    <h2>Les limites de l'héritage</h2>
					                    <p>
                                         En fait, l'héritage sert pas à grand chose en JavaScript,
                                         on peut toujours faire sans ! 
                                        </p>
                                        <small><textarea autojslog="js6-inherit-limit2" rows="13" cols="45">
class Square {
  constructor(side) { this.side = side; }
  surface() { return this.side * this.side; }
}
class Rectangle {
  constructor(width, height) {
    this.width = width; this.height = height; 
  }
  surface() { return this.width * this.height; }
}
var array = [new Square(3), new Rectangle(2, 3)];
console.log(array.map(e => e.surface()));
                                        </textarea></small>
                                        <p></p>
                                        <small>
                                         <div id="js6-inherit-limit2" class="autojslog"></div>
                                        </small>
				</section>
				
				<section>
				                        <h2>Ajouts de fonctions utilitaires</h2>
				</section>
				<section>
				                        <div id="dom-array-from">
					                    <h2>Array.from() &amp; DOM</h2>
					                    <p>
					                     Array.from permet de prendre une HTMLCollection
					                     et de la voir comme un tableau
                                        </p>
                                        <p>&nbsp;</p>
                                        <small><textarea autojs="js6-array-example" rows="5" cols="55">
let element = document.getElementById("dom-array-from");
element.children.toString()

Array.from(element.children).map(x => x.tagName).join(", ")
                                        </textarea></small>
                                        <small><div id="js6-array-example"></div></small>
                                        <p><small>
                                         
					                    </small></p>
					                    </div>
				</section>
				<section>
				                        <h2>Promesse</h2>
					                    <p>
					                     Une <b>Promise</b> est la promesse d'une valeur (ou erreur) future
                                        </p>
                                        <small><textarea autojslog="js6-promise" rows="11" cols="45">
let promise = new Promise((resolve, reject) => {
  let value = Math.random();   // juste pour l'exemple
  if (value < 0.5) {
    resolve("It works");
  } else {
    reject(Error("oh no"));
  }
});

promise.then(value => console.log(value))
                .catch(err => console.log(err.message));
                                        </textarea></small>
                                        <p></p>
                                        <small>
                                         <div id="js6-promise" class="autojslog"></div>
                                        </small>
                                        <p><small>
                                         
                                        </small></p>
				</section>
				<section>
				                        <h2>Promesse &amp; AJAX à la main</h2>
					                    <p>
					                     
                                        </p>
                                        <small><textarea autojslog="js6-promise-ajax" rows="20" cols="45">
function ajaxPromise(doc) {
  return new Promise((resolve, reject) => {
    let ajax = new XMLHttpRequest();
    ajax.onreadystatechange = () => {
      if (ajax.readyState != 4) { return; }
      if(ajax.status != 200) {
        reject(Error("error " + ajax.status));
      } else {
        resolve(ajax.responseText);
      }
    };
    ajax.open("GET", doc, true);
    ajax.overrideMimeType("application/json");
    ajax.send();
  });
}
ajaxPromise("images/js-object/demo.json")
  .then(value => console.log(value))
  .catch(err => console.log(err.message));
                                        </textarea></small>
                                        <p></p>
                                        <small>
                                         <div id="js6-promise-ajax" class="autojslog"></div>
                                        </small>
				</section>
				<section>
				                        <h2>Fetch</h2>
					                    <p>
					                     <b>fetch()</b> fait une requète AJAX et renvoie une Promise
					                    <br/>
					                     <b>response.json()</b> est aussi une Promise qui va parser le JSON
                                        </p>
                                        <small><textarea autojslog="js6-fetch" rows="10" cols="45">
fetch("images/js-object/demo.json")
  .then(response => {
     if (response.ok) {
       return response.json();
     }
     throw Error(response.statusText);
   })
  .then(object => console.log(object))
  .catch(err => console.log(err.message));
                                        </textarea></small>
                                        <p></p>
                                        <small>
                                         <div id="js6-fetch" class="autojslog"></div>
                                        </small>
                                        <p><small>
                                         Attention, fetch renvoie une réponse même si la réponse est Not Found
                                        </small></p>
				</section>
				<section>
				                        <h2>Fetch d'une image</h2>
					                    <p>
					                     <b>URL.createObjectURL</b> permet de créer une URL locale contenant les données de l'image
                                        </p>
                                        <img style="float: right;" id="fetch-image-example" />
                                        <small><textarea autojslog="js6-fetch-image" rows="14" cols="55">
image = document.getElementById('fetch-image-example');
fetch("images/js-canvas/html5.png")
  .then(response => {
     if (response.ok) {
       return response.blob();
     }
     throw Error(response.statusText);
   })
  .then(blob => {
    let objectURL = URL.createObjectURL(blob);
    image.src = objectURL;
  })
  .catch(err => console.log(err.message));
                                        </textarea></small>
                                        <p></p>
                                        <small>
                                         <div id="js6-fetch-image" class="autojslog"></div>
                                        </small>
				</section>
				
                                         
			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
                                        { src: 'plugin/autoeval/autoeval.js', async: true },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
